{
  "version": 3,
  "sources": ["../../../src/http.ts", "../../../src/gemini/geminiClient.ts", "../../../src/gemini/styleTaxonomy.ts", "../../../src/routes/imageGenerate.ts", "../../../src/routes/modelsList.ts", "../../../src/routes/promptCompose.ts", "../../../src/routes/health.ts", "../../../src/router.ts", "../../../src/index.ts", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts", "../bundle-xc0OZe/middleware-insertion-facade.js", "../../../../../../../../AppData/Roaming/npm/node_modules/wrangler/templates/middleware/common.ts", "../bundle-xc0OZe/middleware-loader.entry.ts"],
  "sourceRoot": "C:\\Users\\Zythis\\source\\repos\\ai-puzzle-maker\\workers\\api\\.wrangler\\tmp\\dev-7M0br1",
  "sourcesContent": ["type JsonValue = string | number | boolean | null | JsonValue[] | { [key: string]: JsonValue }\n\nexport function jsonResponse(data: JsonValue, init: ResponseInit = {}): Response {\n  const headers = new Headers(init.headers)\n  if (!headers.has('Content-Type')) {\n    headers.set('Content-Type', 'application/json; charset=utf-8')\n  }\n\n  return new Response(JSON.stringify(data), {\n    ...init,\n    headers,\n  })\n}\n\nexport function errorResponse(status: number, message: string, details?: JsonValue): Response {\n  return jsonResponse(\n    {\n      error: message,\n      details: details ?? null,\n    },\n    { status },\n  )\n}\n", "import type { Env } from '../index'\nimport type {\n  GeminiErrorResponse,\n  GeminiGenerateContentRequest,\n  GeminiGenerateContentResponse,\n} from './contracts'\n\nexport type GeminiClient = {\n  generateContent: (\n    model: string,\n    body: GeminiGenerateContentRequest,\n  ) => Promise<GeminiGenerateContentResponse>\n}\n\nexport class GeminiApiError extends Error {\n  status: number\n  payload?: GeminiErrorResponse | string\n\n  constructor(message: string, status: number, payload?: GeminiErrorResponse | string) {\n    super(message)\n    this.name = 'GeminiApiError'\n    this.status = status\n    this.payload = payload\n  }\n}\n\nexport function createGeminiClient(env: Env): GeminiClient {\n  const apiKey = env.AI_PUZZLE_MAKER__GEMINI_API_KEY\n  if (!apiKey) {\n    throw new Error('Missing AI_PUZZLE_MAKER__GEMINI_API_KEY')\n  }\n\n  const baseUrl = env.AI_PUZZLE_MAKER__GEMINI_BASE_URL || 'https://generativelanguage.googleapis.com'\n  const trimmedBase = baseUrl.replace(/\\/+$/, '')\n\n  return {\n    async generateContent(model, body) {\n      const url = `${trimmedBase}/v1beta/models/${model}:generateContent`\n      const response = await fetch(url, {\n        method: 'POST',\n        headers: {\n          'content-type': 'application/json; charset=utf-8',\n          'x-goog-api-key': apiKey,\n        },\n        body: JSON.stringify(body),\n      })\n\n      if (!response.ok) {\n        const payload = await readErrorPayload(response)\n        const message = payloadMessage(payload) || `Gemini API error (${response.status})`\n        throw new GeminiApiError(message, response.status, payload)\n      }\n\n      return (await response.json()) as GeminiGenerateContentResponse\n    },\n  }\n}\n\nasync function readErrorPayload(response: Response): Promise<GeminiErrorResponse | string> {\n  try {\n    return (await response.json()) as GeminiErrorResponse\n  } catch {\n    try {\n      return await response.text()\n    } catch {\n      return ''\n    }\n  }\n}\n\nfunction payloadMessage(payload: GeminiErrorResponse | string): string | null {\n  if (!payload) {\n    return null\n  }\n\n  if (typeof payload === 'string') {\n    return payload.trim() || null\n  }\n\n  return payload.error?.message ?? null\n}\n", "export type StyleTagGroup = 'medium' | 'surface' | 'lighting' | 'composition' | 'palette'\n\nexport type StyleTag = {\n  id: string\n  label: string\n  group: StyleTagGroup\n}\n\nexport type BaseTemplate = {\n  id: string\n  label: string\n  prompt: string\n}\n\nexport type MoodTag = {\n  id: string\n  label: string\n}\n\nexport const baseTemplates: BaseTemplate[] = [\n  {\n    id: 'nature.alpine-lake.sunrise',\n    label: 'Alpine lake at sunrise',\n    prompt: 'An alpine lake at sunrise with calm water reflecting nearby mountains',\n  },\n  {\n    id: 'nature.misty-pine-forest',\n    label: 'Misty pine forest',\n    prompt: 'A misty pine forest with layered evergreens and soft morning light',\n  },\n  {\n    id: 'nature.desert-dunes',\n    label: 'Desert dunes',\n    prompt: 'Rolling desert dunes with rippled sand textures under a clear sky',\n  },\n  {\n    id: 'nature.tropical-reef',\n    label: 'Tropical reef',\n    prompt: 'A tropical coral reef scene with colorful fish and bright underwater light',\n  },\n  {\n    id: 'nature.waterfall-canyon',\n    label: 'Waterfall canyon',\n    prompt: 'A canyon waterfall with lush greenery, mist, and layered rock walls',\n  },\n  {\n    id: 'travel.old-town-streets',\n    label: 'Old town streets',\n    prompt: 'Charming old town streets with warm lanterns and cobblestone paths',\n  },\n  {\n    id: 'travel.mountain-village',\n    label: 'Mountain village',\n    prompt: 'A cozy mountain village nestled among peaks with rustic cabins',\n  },\n  {\n    id: 'travel.coastal-lighthouse',\n    label: 'Coastal lighthouse',\n    prompt: 'A coastal lighthouse overlooking a rocky shoreline at sunset',\n  },\n  {\n    id: 'travel.harbor-boats',\n    label: 'Harbor boats',\n    prompt: 'A harbor scene with small boats, reflections, and seaside buildings',\n  },\n  {\n    id: 'travel.hot-air-balloons',\n    label: 'Hot air balloons',\n    prompt: 'Colorful hot air balloons floating over a scenic landscape',\n  },\n  {\n    id: 'animals.fox-in-snow',\n    label: 'Fox in snow',\n    prompt: 'A red fox in a snowy meadow with soft falling snowflakes',\n  },\n  {\n    id: 'animals.owl-on-branch',\n    label: 'Owl on branch',\n    prompt: 'A calm owl perched on a branch with a gentle forest backdrop',\n  },\n  {\n    id: 'animals.koi-pond',\n    label: 'Koi pond',\n    prompt: 'A koi pond with lily pads, ripples, and bright koi fish',\n  },\n  {\n    id: 'animals.horses-at-dawn',\n    label: 'Horses at dawn',\n    prompt: 'Horses at dawn in a misty field with warm early light',\n  },\n  {\n    id: 'animals.butterflies-in-meadow',\n    label: 'Butterflies in meadow',\n    prompt: 'Butterflies fluttering over a flower-filled meadow in soft daylight',\n  },\n  {\n    id: 'still-life.fruit-bowl-linen',\n    label: 'Fruit bowl on linen',\n    prompt: 'A still life of a fruit bowl on a linen cloth near a window',\n  },\n  {\n    id: 'still-life.tea-set-window',\n    label: 'Tea set by window',\n    prompt: 'A tea set by a window with gentle light and warm tones',\n  },\n  {\n    id: 'still-life.autumn-leaves',\n    label: 'Autumn leaves',\n    prompt: 'A still life of autumn leaves with rich textures and warm colors',\n  },\n  {\n    id: 'still-life.flowers-in-vase',\n    label: 'Flowers in vase',\n    prompt: 'Fresh flowers in a vase on a tabletop with soft ambient light',\n  },\n  {\n    id: 'abstract.geometric-gradients',\n    label: 'Geometric gradients',\n    prompt: 'Abstract geometric gradients with smooth color transitions',\n  },\n  {\n    id: 'abstract.stained-glass-symmetry',\n    label: 'Stained glass symmetry',\n    prompt: 'A symmetrical stained glass inspired pattern with bold shapes',\n  },\n  {\n    id: 'abstract.swirling-inks',\n    label: 'Swirling inks',\n    prompt: 'Swirling inks with fluid motion and layered colors',\n  },\n  {\n    id: 'abstract.mosaic-tessellations',\n    label: 'Mosaic tessellations',\n    prompt: 'A mosaic tessellation pattern with repeating geometric forms',\n  },\n  {\n    id: 'abstract.fractals',\n    label: 'Fractals',\n    prompt: 'Fractal-inspired patterns with intricate repeating structures',\n  },\n  {\n    id: 'abstract.sacred-geometry',\n    label: 'Sacred geometry',\n    prompt: 'Sacred geometry motifs with clean lines and balanced symmetry',\n  },\n  {\n    id: 'seasonal.cherry-blossoms',\n    label: 'Cherry blossoms',\n    prompt: 'Cherry blossoms in bloom along a peaceful walkway',\n  },\n  {\n    id: 'seasonal.halloween-pumpkins',\n    label: 'Halloween pumpkins',\n    prompt: 'A cozy autumn scene with pumpkins and gentle candlelight',\n  },\n  {\n    id: 'seasonal.winter-cabin-lights',\n    label: 'Winter cabin lights',\n    prompt: 'A winter cabin with warm lights glowing in a snowy landscape',\n  },\n  {\n    id: 'seasonal.spring-rain-cityscape',\n    label: 'Spring rain cityscape',\n    prompt: 'A spring rain cityscape with reflections on wet streets',\n  },\n  {\n    id: 'fantasy.cozy-wizard-study',\n    label: 'Cozy wizard study',\n    prompt: 'A cozy wizard study with books, warm light, and whimsical details',\n  },\n  {\n    id: 'fantasy.floating-lantern-festival',\n    label: 'Floating lantern festival',\n    prompt: 'A floating lantern festival over a river with glowing lights',\n  },\n  {\n    id: 'fantasy.enchanted-library',\n    label: 'Enchanted library',\n    prompt: 'An enchanted library with towering shelves and soft magical glow',\n  },\n  {\n    id: 'fantasy.sky-islands',\n    label: 'Sky islands',\n    prompt: 'Floating sky islands with waterfalls and drifting clouds',\n  },\n  {\n    id: 'fantasy.castles',\n    label: 'Castles',\n    prompt: 'A scenic castle on a hill with dramatic skies and rolling fields',\n  },\n]\n\nexport const styleTags: StyleTag[] = [\n  { id: 'medium.watercolor', label: 'Watercolor wash', group: 'medium' },\n  { id: 'medium.gouache', label: 'Gouache poster paint', group: 'medium' },\n  { id: 'medium.oil-impasto', label: 'Oil painting impasto', group: 'medium' },\n  { id: 'medium.colored-pencil', label: 'Colored pencil illustration', group: 'medium' },\n  { id: 'medium.ink-linework', label: 'Ink linework', group: 'medium' },\n  { id: 'medium.charcoal', label: 'Charcoal sketch', group: 'medium' },\n  { id: 'medium.pastel-chalk', label: 'Pastel chalk', group: 'medium' },\n  { id: 'medium.paper-cut-collage', label: 'Paper cut collage', group: 'medium' },\n  { id: 'medium.stained-glass-mosaic', label: 'Stained glass mosaic', group: 'medium' },\n  { id: 'medium.low-poly-3d', label: 'Low poly 3D render', group: 'medium' },\n  { id: 'medium.claymation', label: 'Claymation look', group: 'medium' },\n  { id: 'medium.pixel-art', label: 'Pixel art', group: 'medium' },\n  { id: 'medium.vector-flat', label: 'Vector flat design', group: 'medium' },\n  { id: 'medium.linocut', label: 'Linocut print texture', group: 'medium' },\n  { id: 'medium.woodblock-print', label: 'Japanese woodblock print look', group: 'medium' },\n  { id: 'medium.art-nouveau', label: 'Art Nouveau ornamental poster look', group: 'medium' },\n  { id: 'surface.cold-press-paper', label: 'Cold press paper texture', group: 'surface' },\n  { id: 'surface.canvas-weave', label: 'Canvas weave', group: 'surface' },\n  { id: 'surface.parchment', label: 'Parchment', group: 'surface' },\n  { id: 'surface.glossy-enamel', label: 'Glossy enamel', group: 'surface' },\n  { id: 'surface.ceramic-tile', label: 'Ceramic tile', group: 'surface' },\n  { id: 'surface.weathered-wood', label: 'Weathered wood', group: 'surface' },\n  { id: 'surface.metallic-foil', label: 'Metallic foil accents', group: 'surface' },\n  { id: 'lighting.golden-hour', label: 'Golden hour glow', group: 'lighting' },\n  { id: 'lighting.soft-overcast', label: 'Soft overcast', group: 'lighting' },\n  { id: 'lighting.neon-night-rain', label: 'Neon night rain', group: 'lighting' },\n  { id: 'lighting.candlelit', label: 'Candlelit warmth', group: 'lighting' },\n  { id: 'lighting.dreamy-haze', label: 'Dreamy haze', group: 'lighting' },\n  { id: 'lighting.high-contrast', label: 'Crisp high contrast', group: 'lighting' },\n  { id: 'composition.wide-cinematic', label: 'Wide cinematic', group: 'composition' },\n  { id: 'composition.macro', label: 'Macro close up', group: 'composition' },\n  { id: 'composition.top-down', label: 'Top down flat lay', group: 'composition' },\n  { id: 'composition.centered-symmetry', label: 'Centered symmetry', group: 'composition' },\n  { id: 'composition.rule-of-thirds', label: 'Rule of thirds', group: 'composition' },\n  { id: 'palette.pastel-spring', label: 'Pastel spring', group: 'palette' },\n  { id: 'palette.autumn-earth', label: 'Autumn earth tones', group: 'palette' },\n  { id: 'palette.teal-orange', label: 'Teal and orange cinematic', group: 'palette' },\n  { id: 'palette.monochrome-ink', label: 'Monochrome ink', group: 'palette' },\n  { id: 'palette.jewel-tones', label: 'Jewel tones', group: 'palette' },\n]\n\nexport const moodTags: MoodTag[] = [\n  { id: 'mood.cozy', label: 'Cozy' },\n  { id: 'mood.serene', label: 'Serene' },\n  { id: 'mood.vibrant', label: 'Vibrant' },\n  { id: 'mood.whimsical', label: 'Whimsical' },\n  { id: 'mood.dramatic', label: 'Dramatic' },\n  { id: 'mood.melancholy', label: 'Melancholy' },\n  { id: 'mood.mysterious', label: 'Mysterious' },\n  { id: 'mood.playful', label: 'Playful' },\n  { id: 'mood.warm', label: 'Warm' },\n  { id: 'mood.cool', label: 'Cool' },\n]\n\nconst baseTemplateById = new Map(baseTemplates.map((template) => [template.id, template]))\nconst styleTagById = new Map(styleTags.map((tag) => [tag.id, tag]))\nconst moodTagById = new Map(moodTags.map((tag) => [tag.id, tag]))\nconst paletteTagById = new Map(styleTags.filter((tag) => tag.group === 'palette').map((tag) => [tag.id, tag]))\n\nexport function getBaseTemplate(id: string): BaseTemplate | undefined {\n  return baseTemplateById.get(id)\n}\n\nexport function getStyleTag(id: string): StyleTag | undefined {\n  return styleTagById.get(id)\n}\n\nexport function getMoodTag(id: string): MoodTag | undefined {\n  return moodTagById.get(id)\n}\n\nexport function getPaletteTag(id: string): StyleTag | undefined {\n  return paletteTagById.get(id)\n}\n", "import type { Env } from '../index'\nimport { errorResponse, jsonResponse } from '../http'\nimport { createGeminiClient, GeminiApiError } from '../gemini/geminiClient'\nimport type { GeminiGenerateContentRequest } from '../gemini/contracts'\nimport { getStyleTag } from '../gemini/styleTaxonomy'\n\nconst ALLOWED_ASPECT_RATIOS = new Set(['1:1', '4:3', '16:9', '9:16', '3:2', '2:3'])\nconst ALLOWED_IMAGE_MODELS = new Set(['gemini-2.5-flash-image', 'gemini-3-pro-image-preview'])\n\ntype ImageGenerateRequest =\n  | {\n      kind: 'default'\n      finalPrompt: string\n      negativeConstraints: string[]\n      aspectRatio: string\n      imageModel: string\n    }\n  | {\n      kind: 'user'\n      userPrompt: string\n      styleTags?: string[]\n      aspectRatio: string\n      imageModel: string\n    }\n\nexport async function handleImageGenerate(request: Request, env: Env): Promise<Response> {\n  if (request.method !== 'POST') {\n    return errorResponse(405, 'Method not allowed')\n  }\n\n  let payload: ImageGenerateRequest\n  try {\n    payload = (await request.json()) as ImageGenerateRequest\n  } catch {\n    return errorResponse(400, 'Invalid JSON payload')\n  }\n\n  const validation = validatePayload(payload)\n  if (!validation.ok) {\n    return errorResponse(400, 'Invalid request', { issues: validation.issues })\n  }\n\n  const promptUsed = buildPrompt(payload)\n  const requestBody: GeminiGenerateContentRequest = {\n    contents: [\n      {\n        role: 'user',\n        parts: [{ text: promptUsed }],\n      },\n    ],\n    generationConfig: {\n      imageConfig: {\n        aspectRatio: payload.aspectRatio,\n      },\n    },\n  }\n\n  const client = createGeminiClient(env)\n\n  try {\n    const response = await client.generateContent(payload.imageModel, requestBody)\n    const imagePart = extractInlineImage(response)\n    if (!imagePart) {\n      return errorResponse(502, 'Image model returned no image data')\n    }\n\n    const imageBase64 = imagePart.inlineData.data\n    const imageMimeType = imagePart.inlineData.mimeType || 'image/png'\n    const dimensions = getImageDimensions(imageMimeType, imageBase64)\n\n    return jsonResponse({\n      imageMimeType,\n      imageBase64,\n      width: dimensions.width,\n      height: dimensions.height,\n      promptUsed,\n      model: payload.imageModel,\n    })\n  } catch (error) {\n    if (error instanceof GeminiApiError) {\n      return errorResponse(502, error.message)\n    }\n\n    const message = error instanceof Error ? error.message : 'Unexpected error'\n    return errorResponse(500, message)\n  }\n}\n\nfunction validatePayload(payload: ImageGenerateRequest): { ok: true } | { ok: false; issues: string[] } {\n  const issues: string[] = []\n\n  if (!payload || typeof payload !== 'object') {\n    return { ok: false, issues: ['Payload must be an object'] }\n  }\n\n  if (payload.kind !== 'default' && payload.kind !== 'user') {\n    issues.push('kind must be \"default\" or \"user\"')\n  }\n\n  if (!ALLOWED_ASPECT_RATIOS.has(payload.aspectRatio)) {\n    issues.push('aspectRatio is invalid')\n  }\n\n  if (!ALLOWED_IMAGE_MODELS.has(payload.imageModel)) {\n    issues.push('imageModel is not allowed')\n  }\n\n  if (payload.kind === 'default') {\n    if (typeof payload.finalPrompt !== 'string' || !payload.finalPrompt.trim()) {\n      issues.push('finalPrompt is required')\n    }\n    if (!Array.isArray(payload.negativeConstraints)) {\n      issues.push('negativeConstraints must be an array of strings')\n    } else {\n      for (const item of payload.negativeConstraints) {\n        if (typeof item !== 'string') {\n          issues.push('negativeConstraints must be an array of strings')\n          break\n        }\n      }\n    }\n  }\n\n  if (payload.kind === 'user') {\n    if (typeof payload.userPrompt !== 'string' || !payload.userPrompt.trim()) {\n      issues.push('userPrompt is required')\n    }\n    if (payload.styleTags !== undefined) {\n      if (!Array.isArray(payload.styleTags)) {\n        issues.push('styleTags must be an array of strings')\n      } else {\n        for (const tagId of payload.styleTags) {\n          if (typeof tagId !== 'string' || !getStyleTag(tagId)) {\n            issues.push(`styleTags contains invalid id: ${String(tagId)}`)\n          }\n        }\n      }\n    }\n  }\n\n  return issues.length > 0 ? { ok: false, issues } : { ok: true }\n}\n\nfunction buildPrompt(payload: ImageGenerateRequest): string {\n  const guardrails = [\n    'Create an original, copyright-safe scene.',\n    'Do not include copyrighted characters, logos, brand names, or trademarks.',\n    'Do not mention living artists.',\n    'Avoid recognizable IP.',\n    'Avoid text overlays unless explicitly requested.',\n  ]\n\n  if (payload.kind === 'default') {\n    const negatives =\n      payload.negativeConstraints.length > 0\n        ? `Avoid: ${payload.negativeConstraints.join(', ')}.`\n        : ''\n    return [payload.finalPrompt.trim(), negatives, ...guardrails].filter(Boolean).join(' ')\n  }\n\n  const styleLine =\n    payload.styleTags && payload.styleTags.length > 0\n      ? `Style tags: ${payload.styleTags.map((id) => getStyleTag(id)!.label).join(', ')}.`\n      : ''\n  return [payload.userPrompt.trim(), styleLine, ...guardrails].filter(Boolean).join(' ')\n}\n\nfunction extractInlineImage(response: {\n  candidates?: Array<{ content?: { parts?: Array<{ inlineData?: { data: string; mimeType: string } }> } }>\n}): { inlineData: { data: string; mimeType: string } } | null {\n  const candidates = response.candidates ?? []\n  for (const candidate of candidates) {\n    const parts = candidate.content?.parts ?? []\n    for (const part of parts) {\n      if (part.inlineData?.data) {\n        return { inlineData: part.inlineData }\n      }\n    }\n  }\n  return null\n}\n\nfunction getImageDimensions(mimeType: string, base64: string): { width: number; height: number } {\n  const bytes = base64ToBytes(base64)\n  if (mimeType === 'image/png') {\n    const png = parsePngDimensions(bytes)\n    if (png) {\n      return png\n    }\n  }\n\n  if (mimeType === 'image/webp') {\n    const webp = parseWebpDimensions(bytes)\n    if (webp) {\n      return webp\n    }\n  }\n\n  return { width: 0, height: 0 }\n}\n\nfunction base64ToBytes(base64: string): Uint8Array {\n  const binary = atob(base64)\n  const bytes = new Uint8Array(binary.length)\n  for (let i = 0; i < binary.length; i += 1) {\n    bytes[i] = binary.charCodeAt(i)\n  }\n  return bytes\n}\n\nfunction parsePngDimensions(bytes: Uint8Array): { width: number; height: number } | null {\n  if (bytes.length < 24) {\n    return null\n  }\n\n  const pngSignature = [0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a]\n  for (let i = 0; i < pngSignature.length; i += 1) {\n    if (bytes[i] !== pngSignature[i]) {\n      return null\n    }\n  }\n\n  const width = readUint32BE(bytes, 16)\n  const height = readUint32BE(bytes, 20)\n  if (width <= 0 || height <= 0) {\n    return null\n  }\n\n  return { width, height }\n}\n\nfunction parseWebpDimensions(bytes: Uint8Array): { width: number; height: number } | null {\n  if (bytes.length < 30) {\n    return null\n  }\n\n  if (\n    bytes[0] !== 0x52 ||\n    bytes[1] !== 0x49 ||\n    bytes[2] !== 0x46 ||\n    bytes[3] !== 0x46 ||\n    bytes[8] !== 0x57 ||\n    bytes[9] !== 0x45 ||\n    bytes[10] !== 0x42 ||\n    bytes[11] !== 0x50\n  ) {\n    return null\n  }\n\n  const chunkType = String.fromCharCode(bytes[12], bytes[13], bytes[14], bytes[15])\n  if (chunkType === 'VP8X') {\n    const width = 1 + readUint24LE(bytes, 24)\n    const height = 1 + readUint24LE(bytes, 27)\n    return { width, height }\n  }\n\n  if (chunkType === 'VP8 ') {\n    if (bytes.length < 30) {\n      return null\n    }\n    const width = bytes[26] | (bytes[27] << 8)\n    const height = bytes[28] | (bytes[29] << 8)\n    return { width, height }\n  }\n\n  return null\n}\n\nfunction readUint32BE(bytes: Uint8Array, offset: number): number {\n  return (\n    (bytes[offset] << 24) |\n    (bytes[offset + 1] << 16) |\n    (bytes[offset + 2] << 8) |\n    bytes[offset + 3]\n  ) >>> 0\n}\n\nfunction readUint24LE(bytes: Uint8Array, offset: number): number {\n  return bytes[offset] | (bytes[offset + 1] << 8) | (bytes[offset + 2] << 16)\n}\n", "import { jsonResponse } from '../http'\n\nconst TEXT_MODELS = ['gemini-2.5-flash']\nconst IMAGE_MODELS = ['gemini-2.5-flash-image', 'gemini-3-pro-image-preview']\n\nexport function handleModelsList(): Response {\n  return jsonResponse({\n    textModels: TEXT_MODELS,\n    imageModels: IMAGE_MODELS,\n  })\n}\n", "import type { Env } from '../index'\nimport { errorResponse, jsonResponse } from '../http'\nimport { createGeminiClient, GeminiApiError } from '../gemini/geminiClient'\nimport type { GeminiGenerateContentRequest } from '../gemini/contracts'\nimport {\n  getBaseTemplate,\n  getMoodTag,\n  getPaletteTag,\n  getStyleTag,\n} from '../gemini/styleTaxonomy'\n\nconst MODEL_ID = 'gemini-2.5-flash'\nconst ALLOWED_ASPECT_RATIOS = new Set(['1:1', '4:3', '16:9', '9:16', '3:2', '2:3'])\n\ntype PromptComposeRequest = {\n  baseTemplateId: string\n  styleTags: string[]\n  moodTags?: string[]\n  paletteTags?: string[]\n  extraDetails?: string\n  aspectRatio: string\n}\n\nexport async function handlePromptCompose(request: Request, env: Env): Promise<Response> {\n  if (request.method !== 'POST') {\n    return errorResponse(405, 'Method not allowed')\n  }\n\n  let payload: PromptComposeRequest\n  try {\n    payload = (await request.json()) as PromptComposeRequest\n  } catch {\n    return errorResponse(400, 'Invalid JSON payload')\n  }\n\n  const validation = validatePayload(payload)\n  if (!validation.ok) {\n    return errorResponse(400, 'Invalid request', { issues: validation.issues })\n  }\n\n  const baseTemplate = getBaseTemplate(payload.baseTemplateId)!\n  const styleLabels = payload.styleTags.map((id) => getStyleTag(id)!.label)\n  const moodLabels = (payload.moodTags ?? []).map((id) => getMoodTag(id)!.label)\n  const paletteLabels = (payload.paletteTags ?? []).map((id) => getPaletteTag(id)!.label)\n\n  const promptLines = [\n    `Base template: ${baseTemplate.prompt}.`,\n    `Style tags: ${styleLabels.join(', ')}.`,\n    `Target aspect ratio: ${payload.aspectRatio}.`,\n  ]\n\n  if (moodLabels.length > 0) {\n    promptLines.push(`Mood tags: ${moodLabels.join(', ')}.`)\n  }\n\n  if (paletteLabels.length > 0) {\n    promptLines.push(`Palette tags: ${paletteLabels.join(', ')}.`)\n  }\n\n  if (payload.extraDetails?.trim()) {\n    promptLines.push(`Extra details: ${payload.extraDetails.trim()}.`)\n  }\n\n  const client = createGeminiClient(env)\n  const requestBody: GeminiGenerateContentRequest = {\n    system_instruction: {\n      parts: [\n        {\n          text:\n            'You are a prompt composer for a jigsaw puzzle image generator. ' +\n            'Create an original, copyright-safe scene. Do not include copyrighted characters, ' +\n            'logos, brand names, or trademarks. Do not mention living artists. Avoid recognizable IP. ' +\n            'Avoid text overlays unless explicitly requested. Return only valid JSON that matches the schema.',\n        },\n      ],\n    },\n    contents: [\n      {\n        role: 'user',\n        parts: [\n          {\n            text: promptLines.join('\\n'),\n          },\n        ],\n      },\n    ],\n    generationConfig: {\n      responseMimeType: 'application/json',\n      responseSchema: {\n        type: 'object',\n        properties: {\n          title: { type: 'string' },\n          finalPrompt: { type: 'string' },\n          negativeConstraints: { type: 'array', items: { type: 'string' } },\n          altText: { type: 'string' },\n          seedHint: { type: 'string' },\n        },\n        required: ['finalPrompt', 'altText'],\n      },\n    },\n  }\n\n  try {\n    const response = await client.generateContent(MODEL_ID, requestBody)\n    const responseText = extractFirstText(response)\n    if (!responseText) {\n      return errorResponse(502, 'Prompt composer returned no content')\n    }\n\n    const parsed = safeJsonParse(responseText)\n    if (!parsed || typeof parsed !== 'object') {\n      return errorResponse(502, 'Prompt composer returned invalid JSON')\n    }\n\n    const finalPrompt = typeof parsed.finalPrompt === 'string' ? parsed.finalPrompt.trim() : ''\n    const altText = typeof parsed.altText === 'string' ? parsed.altText.trim() : ''\n\n    if (!finalPrompt || !altText) {\n      return errorResponse(502, 'Prompt composer returned incomplete data')\n    }\n\n    const title =\n      typeof parsed.title === 'string' && parsed.title.trim() ? parsed.title.trim() : 'Untitled'\n    const negativeConstraints = Array.isArray(parsed.negativeConstraints)\n      ? parsed.negativeConstraints\n          .map((item) => (typeof item === 'string' ? item.trim() : ''))\n          .filter((item) => item.length > 0)\n      : []\n\n    return jsonResponse({\n      title,\n      finalPrompt,\n      negativeConstraints,\n      altText,\n      model: MODEL_ID,\n    })\n  } catch (error) {\n    if (error instanceof GeminiApiError) {\n      return errorResponse(502, error.message)\n    }\n\n    const message = error instanceof Error ? error.message : 'Unexpected error'\n    return errorResponse(500, message)\n  }\n}\n\nfunction validatePayload(payload: PromptComposeRequest): { ok: true } | { ok: false; issues: string[] } {\n  const issues: string[] = []\n\n  if (!payload || typeof payload !== 'object') {\n    return { ok: false, issues: ['Payload must be an object'] }\n  }\n\n  if (typeof payload.baseTemplateId !== 'string' || !payload.baseTemplateId.trim()) {\n    issues.push('baseTemplateId is required')\n  } else if (!getBaseTemplate(payload.baseTemplateId)) {\n    issues.push('baseTemplateId is not recognized')\n  }\n\n  if (!Array.isArray(payload.styleTags)) {\n    issues.push('styleTags must be an array of strings')\n  } else {\n    if (payload.styleTags.length === 0) {\n      issues.push('styleTags must not be empty')\n    }\n    for (const tagId of payload.styleTags) {\n      if (typeof tagId !== 'string' || !getStyleTag(tagId)) {\n        issues.push(`styleTags contains invalid id: ${String(tagId)}`)\n      }\n    }\n  }\n\n  if (!ALLOWED_ASPECT_RATIOS.has(payload.aspectRatio)) {\n    issues.push('aspectRatio is invalid')\n  }\n\n  if (payload.moodTags !== undefined) {\n    if (!Array.isArray(payload.moodTags)) {\n      issues.push('moodTags must be an array of strings')\n    } else {\n      for (const tagId of payload.moodTags) {\n        if (typeof tagId !== 'string' || !getMoodTag(tagId)) {\n          issues.push(`moodTags contains invalid id: ${String(tagId)}`)\n        }\n      }\n    }\n  }\n\n  if (payload.paletteTags !== undefined) {\n    if (!Array.isArray(payload.paletteTags)) {\n      issues.push('paletteTags must be an array of strings')\n    } else {\n      for (const tagId of payload.paletteTags) {\n        if (typeof tagId !== 'string' || !getPaletteTag(tagId)) {\n          issues.push(`paletteTags contains invalid id: ${String(tagId)}`)\n        }\n      }\n    }\n  }\n\n  if (payload.extraDetails !== undefined && typeof payload.extraDetails !== 'string') {\n    issues.push('extraDetails must be a string')\n  }\n\n  return issues.length > 0 ? { ok: false, issues } : { ok: true }\n}\n\nfunction extractFirstText(response: { candidates?: Array<{ content?: { parts?: Array<{ text?: string }> } }> }): string | null {\n  const candidates = response.candidates ?? []\n  for (const candidate of candidates) {\n    const parts = candidate.content?.parts ?? []\n    for (const part of parts) {\n      if (typeof part.text === 'string' && part.text.trim()) {\n        return part.text\n      }\n    }\n  }\n  return null\n}\n\nfunction safeJsonParse(input: string): any {\n  try {\n    return JSON.parse(input)\n  } catch {\n    return null\n  }\n}\n", "import { jsonResponse } from '../http'\n\nexport function handleHealth(): Response {\n  return jsonResponse({\n    ok: true,\n    service: 'ai-puzzle-maker-api',\n  })\n}\n", "import type { Env } from './index'\n\nexport type Handler = (\n  request: Request,\n  env: Env,\n  ctx: ExecutionContext,\n) => Promise<Response> | Response\n\ntype Route = {\n  method: string\n  path: string\n  handler: Handler\n}\n\nexport class Router {\n  private routes: Route[] = []\n\n  add(method: string, path: string, handler: Handler) {\n    this.routes.push({\n      method: method.toUpperCase(),\n      path,\n      handler,\n    })\n    return this\n  }\n\n  async handle(request: Request, env: Env, ctx: ExecutionContext): Promise<Response | null> {\n    const url = new URL(request.url)\n    const path = normalizePath(url.pathname)\n    const method = request.method.toUpperCase()\n    const route = this.routes.find((candidate) => candidate.method === method && candidate.path === path)\n\n    if (!route) {\n      return null\n    }\n\n    return await route.handler(request, env, ctx)\n  }\n}\n\nfunction normalizePath(pathname: string): string {\n  if (pathname === '/api') {\n    return '/'\n  }\n\n  if (pathname.startsWith('/api/')) {\n    const trimmed = pathname.slice(4)\n    return trimmed.length > 0 ? trimmed : '/'\n  }\n\n  return pathname\n}\n", "import { errorResponse } from './http'\nimport { handleImageGenerate } from './routes/imageGenerate'\nimport { handleModelsList } from './routes/modelsList'\nimport { handlePromptCompose } from './routes/promptCompose'\nimport { handleHealth } from './routes/health'\nimport { Router } from './router'\n\nexport interface Env {\n  AI_PUZZLE_MAKER__GEMINI_API_KEY?: string\n  AI_PUZZLE_MAKER__GEMINI_BASE_URL?: string\n}\n\nconst router = new Router()\nrouter.add('GET', '/health', handleHealth)\nrouter.add('POST', '/prompt/compose', handlePromptCompose)\nrouter.add('POST', '/image/generate', handleImageGenerate)\nrouter.add('GET', '/models', handleModelsList)\n\nexport default {\n  async fetch(request: Request, env: Env, ctx: ExecutionContext): Promise<Response> {\n    try {\n      if (request.method === 'OPTIONS') {\n        return new Response(null, { status: 204 })\n      }\n\n      const response = await router.handle(request, env, ctx)\n      if (response) {\n        return response\n      }\n\n      return errorResponse(404, 'Not found')\n    } catch (error) {\n      const message = error instanceof Error ? error.message : 'Unexpected error'\n      return errorResponse(500, message)\n    }\n  },\n}\n", "import type { Middleware } from \"./common\";\n\nconst drainBody: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} finally {\n\t\ttry {\n\t\t\tif (request.body !== null && !request.bodyUsed) {\n\t\t\t\tconst reader = request.body.getReader();\n\t\t\t\twhile (!(await reader.read()).done) {}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Failed to drain the unused request body.\", e);\n\t\t}\n\t}\n};\n\nexport default drainBody;\n", "import type { Middleware } from \"./common\";\n\ninterface JsonError {\n\tmessage?: string;\n\tname?: string;\n\tstack?: string;\n\tcause?: JsonError;\n}\n\nfunction reduceError(e: any): JsonError {\n\treturn {\n\t\tname: e?.name,\n\t\tmessage: e?.message ?? String(e),\n\t\tstack: e?.stack,\n\t\tcause: e?.cause === undefined ? undefined : reduceError(e.cause),\n\t};\n}\n\n// See comment in `bundle.ts` for details on why this is needed\nconst jsonError: Middleware = async (request, env, _ctx, middlewareCtx) => {\n\ttry {\n\t\treturn await middlewareCtx.next(request, env);\n\t} catch (e: any) {\n\t\tconst error = reduceError(e);\n\t\treturn Response.json(error, {\n\t\t\tstatus: 500,\n\t\t\theaders: { \"MF-Experimental-Error-Stack\": \"true\" },\n\t\t});\n\t}\n};\n\nexport default jsonError;\n", "\t\t\t\timport worker, * as OTHER_EXPORTS from \"C:\\\\Users\\\\Zythis\\\\source\\\\repos\\\\ai-puzzle-maker\\\\workers\\\\api\\\\src\\\\index.ts\";\n\t\t\t\timport * as __MIDDLEWARE_0__ from \"C:\\\\Users\\\\Zythis\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-ensure-req-body-drained.ts\";\nimport * as __MIDDLEWARE_1__ from \"C:\\\\Users\\\\Zythis\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\middleware-miniflare3-json-error.ts\";\n\n\t\t\t\texport * from \"C:\\\\Users\\\\Zythis\\\\source\\\\repos\\\\ai-puzzle-maker\\\\workers\\\\api\\\\src\\\\index.ts\";\n\t\t\t\tconst MIDDLEWARE_TEST_INJECT = \"__INJECT_FOR_TESTING_WRANGLER_MIDDLEWARE__\";\n\t\t\t\texport const __INTERNAL_WRANGLER_MIDDLEWARE__ = [\n\t\t\t\t\t\n\t\t\t\t\t__MIDDLEWARE_0__.default,__MIDDLEWARE_1__.default\n\t\t\t\t]\n\t\t\t\texport default worker;", "export type Awaitable<T> = T | Promise<T>;\n// TODO: allow dispatching more events?\nexport type Dispatcher = (\n\ttype: \"scheduled\",\n\tinit: { cron?: string }\n) => Awaitable<void>;\n\nexport type IncomingRequest = Request<\n\tunknown,\n\tIncomingRequestCfProperties<unknown>\n>;\n\nexport interface MiddlewareContext {\n\tdispatch: Dispatcher;\n\tnext(request: IncomingRequest, env: any): Awaitable<Response>;\n}\n\nexport type Middleware = (\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tmiddlewareCtx: MiddlewareContext\n) => Awaitable<Response>;\n\nconst __facade_middleware__: Middleware[] = [];\n\n// The register functions allow for the insertion of one or many middleware,\n// We register internal middleware first in the stack, but have no way of controlling\n// the order that addMiddleware is run in service workers so need an internal function.\nexport function __facade_register__(...args: (Middleware | Middleware[])[]) {\n\t__facade_middleware__.push(...args.flat());\n}\nexport function __facade_registerInternal__(\n\t...args: (Middleware | Middleware[])[]\n) {\n\t__facade_middleware__.unshift(...args.flat());\n}\n\nfunction __facade_invokeChain__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tmiddlewareChain: Middleware[]\n): Awaitable<Response> {\n\tconst [head, ...tail] = middlewareChain;\n\tconst middlewareCtx: MiddlewareContext = {\n\t\tdispatch,\n\t\tnext(newRequest, newEnv) {\n\t\t\treturn __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);\n\t\t},\n\t};\n\treturn head(request, env, ctx, middlewareCtx);\n}\n\nexport function __facade_invoke__(\n\trequest: IncomingRequest,\n\tenv: any,\n\tctx: ExecutionContext,\n\tdispatch: Dispatcher,\n\tfinalMiddleware: Middleware\n): Awaitable<Response> {\n\treturn __facade_invokeChain__(request, env, ctx, dispatch, [\n\t\t...__facade_middleware__,\n\t\tfinalMiddleware,\n\t]);\n}\n", "// This loads all middlewares exposed on the middleware object and then starts\n// the invocation chain. The big idea is that we can add these to the middleware\n// export dynamically through wrangler, or we can potentially let users directly\n// add them as a sort of \"plugin\" system.\n\nimport ENTRY, { __INTERNAL_WRANGLER_MIDDLEWARE__ } from \"C:\\\\Users\\\\Zythis\\\\source\\\\repos\\\\ai-puzzle-maker\\\\workers\\\\api\\\\.wrangler\\\\tmp\\\\bundle-xc0OZe\\\\middleware-insertion-facade.js\";\nimport { __facade_invoke__, __facade_register__, Dispatcher } from \"C:\\\\Users\\\\Zythis\\\\AppData\\\\Roaming\\\\npm\\\\node_modules\\\\wrangler\\\\templates\\\\middleware\\\\common.ts\";\nimport type { WorkerEntrypointConstructor } from \"C:\\\\Users\\\\Zythis\\\\source\\\\repos\\\\ai-puzzle-maker\\\\workers\\\\api\\\\.wrangler\\\\tmp\\\\bundle-xc0OZe\\\\middleware-insertion-facade.js\";\n\n// Preserve all the exports from the worker\nexport * from \"C:\\\\Users\\\\Zythis\\\\source\\\\repos\\\\ai-puzzle-maker\\\\workers\\\\api\\\\.wrangler\\\\tmp\\\\bundle-xc0OZe\\\\middleware-insertion-facade.js\";\n\nclass __Facade_ScheduledController__ implements ScheduledController {\n\treadonly #noRetry: ScheduledController[\"noRetry\"];\n\n\tconstructor(\n\t\treadonly scheduledTime: number,\n\t\treadonly cron: string,\n\t\tnoRetry: ScheduledController[\"noRetry\"]\n\t) {\n\t\tthis.#noRetry = noRetry;\n\t}\n\n\tnoRetry() {\n\t\tif (!(this instanceof __Facade_ScheduledController__)) {\n\t\t\tthrow new TypeError(\"Illegal invocation\");\n\t\t}\n\t\t// Need to call native method immediately in case uncaught error thrown\n\t\tthis.#noRetry();\n\t}\n}\n\nfunction wrapExportedHandler(worker: ExportedHandler): ExportedHandler {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn worker;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\tconst fetchDispatcher: ExportedHandlerFetchHandler = function (\n\t\trequest,\n\t\tenv,\n\t\tctx\n\t) {\n\t\tif (worker.fetch === undefined) {\n\t\t\tthrow new Error(\"Handler does not export a fetch() function.\");\n\t\t}\n\t\treturn worker.fetch(request, env, ctx);\n\t};\n\n\treturn {\n\t\t...worker,\n\t\tfetch(request, env, ctx) {\n\t\t\tconst dispatcher: Dispatcher = function (type, init) {\n\t\t\t\tif (type === \"scheduled\" && worker.scheduled !== undefined) {\n\t\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\t\tDate.now(),\n\t\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t\t() => {}\n\t\t\t\t\t);\n\t\t\t\t\treturn worker.scheduled(controller, env, ctx);\n\t\t\t\t}\n\t\t\t};\n\t\t\treturn __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);\n\t\t},\n\t};\n}\n\nfunction wrapWorkerEntrypoint(\n\tklass: WorkerEntrypointConstructor\n): WorkerEntrypointConstructor {\n\t// If we don't have any middleware defined, just return the handler as is\n\tif (\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__ === undefined ||\n\t\t__INTERNAL_WRANGLER_MIDDLEWARE__.length === 0\n\t) {\n\t\treturn klass;\n\t}\n\t// Otherwise, register all middleware once\n\tfor (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {\n\t\t__facade_register__(middleware);\n\t}\n\n\t// `extend`ing `klass` here so other RPC methods remain callable\n\treturn class extends klass {\n\t\t#fetchDispatcher: ExportedHandlerFetchHandler<Record<string, unknown>> = (\n\t\t\trequest,\n\t\t\tenv,\n\t\t\tctx\n\t\t) => {\n\t\t\tthis.env = env;\n\t\t\tthis.ctx = ctx;\n\t\t\tif (super.fetch === undefined) {\n\t\t\t\tthrow new Error(\"Entrypoint class does not define a fetch() function.\");\n\t\t\t}\n\t\t\treturn super.fetch(request);\n\t\t};\n\n\t\t#dispatcher: Dispatcher = (type, init) => {\n\t\t\tif (type === \"scheduled\" && super.scheduled !== undefined) {\n\t\t\t\tconst controller = new __Facade_ScheduledController__(\n\t\t\t\t\tDate.now(),\n\t\t\t\t\tinit.cron ?? \"\",\n\t\t\t\t\t() => {}\n\t\t\t\t);\n\t\t\t\treturn super.scheduled(controller);\n\t\t\t}\n\t\t};\n\n\t\tfetch(request: Request<unknown, IncomingRequestCfProperties>) {\n\t\t\treturn __facade_invoke__(\n\t\t\t\trequest,\n\t\t\t\tthis.env,\n\t\t\t\tthis.ctx,\n\t\t\t\tthis.#dispatcher,\n\t\t\t\tthis.#fetchDispatcher\n\t\t\t);\n\t\t}\n\t};\n}\n\nlet WRAPPED_ENTRY: ExportedHandler | WorkerEntrypointConstructor | undefined;\nif (typeof ENTRY === \"object\") {\n\tWRAPPED_ENTRY = wrapExportedHandler(ENTRY);\n} else if (typeof ENTRY === \"function\") {\n\tWRAPPED_ENTRY = wrapWorkerEntrypoint(ENTRY);\n}\nexport default WRAPPED_ENTRY;\n"],
  "mappings": "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IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,IACP,QAAQ;AAAA,EACV;AAAA,EACA;AAAA,IACE,IAAI;AAAA,IACJ,OAAO;AAAA,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",
  "names": ["ALLOWED_ASPECT_RATIOS", "validatePayload"]
}
